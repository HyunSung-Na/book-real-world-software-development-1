# Chapter 5 비즈니스 규칙 엔진



### 비즈니스 규칙 엔진 요구 사항

- 비즈니스 규칙 엔진은 간단한 맞춤 언어를 사용해 한 개 이상의 비즈니스 규칙을 실행하는 소프트웨어로 다양한 컴포넌트를 동시에 지원한다.
- 팩트 : 규칙을 확인할 수 있는 정보
- 액션 : 수행하려는 동작
- 조건 : 액션을 언제 발생시킬지 지정
- 규칙 : 실행하려는 비즈니스 규칙을 지정, 보통 팩트, 액션, 조건을 한 그룹으로 묶어 규칙으로 만듦



비즈니스 규칙 엔진의 생산성과 관련된 좋은 점은 규칙이 기존의 응용프로그램과는 독립된 곳에서 실행, 유지보수, 테스트할 수 있다는 점이다.



### 테스트 주도 개발

5장에서는 테스트 주도 개발 방법으로 프로젝트를 진행한다. TDD 철학은 테스트 코드를 먼저 만든 후, 이에 맞춰 코드를 구현하는 것이다.



#### TDD를 사용하는 이유

다음과 같은 장점을 제공하기 때문에 사용한다.

1. 테스트르 ㄹ따로 구현하므로 테스트에 대응하는 요구 사항을 한 개씩 구현할 때마다 필요한 요구 사항에 집중하고 개선할 수 있다.
2. 코드를 올바르게 조직할 수 있다. 예를 들어 먼저 테스트를 구현하면서 코드에 어떤 공개 인터페이스를 만들어야 하는지 신중히 검토하게 된다.
3. TDD 주기에 따라 요구 사항 구현을 반복하면서 종합적인 테스트 스위트를 완성할 수 있으므로 요구사항을 만족시켰다는 사실을 조금 더 확신할 수 있으며 버그 발생 범위도 줄일 수 있다.
4. 테스트를 통과하기 위한 코드를 구현하기 때문에 필요하지 않은 테스트를 구현하는 일을 줄일 수 있다.



#### TDD 주기

TDD는 다음과 같은 주기를 따른다.

1. 실패하는 테스트 구현
2. 모든 테스트 실행
3. 기능이 동작하도록 코드 구현
4. 모든 테스트 실행



🚩 실생활에서는 코드를 항상 **리펙토링**해야 하며 그렇지 않으면 유지보수할 수 없는 코드가 되기 십상이다. 리펙토링하면 코드를 바꿨을 때 뭔가 잘못되어도 의지할 수 있는 테스트 스위트를 갖는다.





### 모킹

모킹은 run()이 실행되었을 때 이를 확인하는 기법으로, 자바의 모킹 라이브러리인 모키토를 이용한다.

1. Mock 생성
2. 메서드가 호출되었는지 확인



```java
	@Test
    public void shouldExecuteOneAction() {
        // given
        final BusinessRuleEngine businessRuleEngine = new BusinessRuleEngine();
        final Action mockAction = mock(Action.class);

        // when
        businessRuleEngine.addAction(mockAction);
        businessRuleEngine.run();

        // then
        verify(mockAction).execute();
    }
```

이런 식으로 mock 객체를 만들고 그 행동을 검증한다.



### 조건 추가하기



